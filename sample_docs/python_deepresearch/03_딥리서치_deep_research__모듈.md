# Chapter 3: 딥리서치(Deep Research) 모듈

---

## 동기(Motivation):  
리서치의 시작점은 좋은 질문이지만, 그 질문을 실제로 "깊고 넓게" 탐구하려면 어떤 연구 방법론이 필요합니다. 마치 한 주제에 대해 더 깊이 파보고, 혼자서 무수히 많은 질문을 던지며 인터넷을 뒤지는 연구원처럼, 우리 프로젝트도 반복적이고 체계적으로 정보를 모으는 뇌를 가져야 합니다.  
딥리서치 모듈은 바로 이 역할, 즉 한 주제를 여러 층(breadth)과 단계(depth)로 분해하고 탐구하는 실질적 "자료 수집 로봇"입니다.

---

## 핵심 아이디어(Key Ideas):

- **자동 SERP 쿼리 생성:** 단순한 질문에서 다양한 웹 검색어(검색 엔진에 넣을 쿼리)를 자동 생성해서 자료 찾기 효율 극대화.
- **실시간 웹검색 연동:** Firecrawl 등의 외부 웹 검색기로부터 진짜 최신 검색 결과를 가져옴.
- **정리와 후속질문:** 각 검색결과에서 "새로 배운 점"과 "더 파고들 질문"을 정리.  
- **재귀적 탐구:** 한 번 파고든 후, 그 결과로 다시 더 좁고 깊은 '후속 탐구'를 자동 반복(재귀)하여 깊이를 쌓음.
- **넓이와 깊이 조율:** 한 단계에서 여러 갈래(breadth)로, 그리고 여러 단계(depth)로 계속 진행.

---

## 코드 흐름 알아보기 (중요 부분만 요약)

### 1. 검색 쿼리 만들기: `generate_serp_queries`

- **역할:**  
  사용자가 궁금한 주제(질문)에 대해 여러 개의 검색 쿼리(키워드)를 인공지능으로 만듭니다.
- **예시:**  
  "딥러닝 트렌드" → "최신 딥러닝 모델", "딥러닝의 한계", "딥러닝 적용 사례"

### 2. 실제 검색 결과 긁어오기: `firecrawl_search`

- **역할:**  
  위에서 만든 쿼리를 진짜 검색엔진에 넣고, 상위 결과(제목, 요약, URL 등)를 가져옵니다.
- **상상:**  
  사용자가 직접 구글이나 네이버에 검색해서 결과를 복사해 오는 거랑 비슷함.

### 3. 결과 요약과 후속 질문 만들기: `process_serp_result`

- **역할:**  
  각 검색 결과를 뭉쳐서 "이것만 알아도 된다" 싶은 요점(학습 내용)과 더 궁금해질 수 있는 후속 질문(재탐색 키워드)을 뽑아냅니다.
- **예시:**  
  "딥러닝의 한계에 대해 실무자들은 어떻게 해결하는가?" 라는 추가 질문 생성  
  "딥러닝은 대량 데이터가 필요하다" 같은 요약 뽑기

### 4. 깊이와 넓이 조절하며 반복 연구: `deep_research`

- **핵심 구조:**  
  1) 쿼리 만들고  
  2) 각 쿼리별로 자료 긁어오고  
  3) 요점/후속 질문 뽑고  
  4) 후속 질문으로 또 쿼리 만들어 반복(breadth/width & depth)  
  5) 모든 과정을 일정 횟수(depth)만큼 재귀적으로 이어감

- **비유:**  
  탐정이 한 사건(질문)에 대해 여러 갈래 증거(쿼리)를 찾고, 각 증거의 단서를 따라가며 계속해서 새로운 사건의 실마리(후속질문)를 찾는 구조와 같음.

---

## 코드 단계별 설명

아래에서 주요 함수들의 작동 원리를 그림처럼 따라가 봅니다.

---

### 1) 검색 쿼리 생성  
**(generate_serp_queries)**  

- 한 문장의 질문을, AI가 알아들을 만한 다수의 검색어로 쪼갭니다.
- 더 이전에 얻은 '학습 내용'이 있다면 그걸 참고해서 더 똑똑한 쿼리를 만들어냅니다.
- 쿼리는 "실제로 검색 엔진에 던질 화두"가 됩니다.

---

### 2) 검색 결괏값 긁어서 저장  
**(firecrawl_search)**  

- 앞서 만든 각 쿼리별로, 실제 Firecrawl 등 외부 웹에서 관련 정보를 긁어옵니다.
- 각각의 결과는 `url`, `제목`, `간단설명`, `마크다운 요약` 등으로 저장됩니다.

---

### 3) 요약과 추가 궁금점 뽑기  
**(process_serp_result)**  

- 여러 웹 결과들을 AI에 던져,  
  - ① 새로운 지식(learning)  
  - ② 새롭게 파고들 만한 질문(followUpQuestions)  
  이 두 가지를 뽑아냅니다.
- 이를 통해 "정보의 요약"과 "다음 탐색 키워드"라는 두 가지 산출물을 얻을 수 있습니다.

---

### 4) 깊이와 넓이로 반복 연구  
**(deep_research 함수=연구 뇌의 본체)**

#### 진행 과정:
1. 질문(주제) -> 여러 검색 쿼리 만듦 (breadth만큼)
2. 각 쿼리에 대해:
    1. 검색 결과 긁고
    2. 요점/후속질문 뽑기
    3. 남은 depth만큼 후속질문을 새로운 쿼리로 만들어 반복
    4. 이미 본 URL, 배운 내용 모두 계속 누적하여 관리
3. 모든 반복이 끝나면 전체 "학습 내용"과 "방문한 URL" 결과를 정리해 반환

#### 포인트:
- breadth가 클수록 한 번에 여러 갈래로 탐구(옆으로 넓게).
- depth가 클수록 한 줄기씩 더 깊고 길게.
- 실제로는 모든 과정이 내부적으로 **재귀**(함수 안에서 자신을 다시 부름) 형식으로 구조화되어 더 체계적인 심층 탐색이 실현됨.

---

## 쉽게 정리하자면...

- 이 모듈은 한 질문을 단순히 한 번 검색해서 끝내지 않습니다.
- 여러 방식(여러 키워드, 여러 후속질문)으로 파도처럼 자료를 모으고 요약하며,  
  점점 더 깊은 층으로 들어가며 정보를 축적합니다.
- **자율성을 가진 리서치봇, 혹은 질문 탐험가**라고 생각하면 이해가 쉽습니다.

---

## 마무리(Wrap-up)

딥리서치 모듈은 단순한 정보 수집을 넘어서,  
질문 → 자료 수집 → 요약 → 후속질문 생성 → 재탐색  
이 일련의 사이클을 "사람 대신 자동"으로 돌려주는 뇌 역할입니다.

이 과정을 통해 여러분은 단순한 '검색 자동화'가 아닌,  
한 주제에 대해 훨씬 구조적으로, 그리고 깊게 들어가  
새로운 인사이트를 끌어낼 수 있는 "연구 탐정"을 만들게 됩니다.

다음 챕터에서는 실제로 이 딥리서치 모듈이 외부의 Firecrawl 웹검색 서비스와 어떻게 긴밀히 연동하는지 알아봅니다.  
각종 최신 정보가, 자동으로 프로젝트 안으로 흘러들어오는 '다리'를 만드는 과정입니다!